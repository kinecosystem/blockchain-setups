version: "3"

services:
  horizon:
    depends_on: [horizon-db]
    image: kinecosystem/horizon:kinecosystem-v2.0.0-stellar-v0.16.1
    container_name: horizon
    network_mode: host  # listens on port 8000
    #entrypoint: ''
    volumes:
            - ./volumes/horizon:/opt/horizon
            - /var/run/postgresql:/var/run/postgresql
    environment:
      DATABASE_URL: "dbname=horizon user=stellar host=/var/run/postgresql password=G17WAqXN7nH0xXWs"
      HORIZON_DB_MAX_OPEN_CONNECTIONS: "200"
      STELLAR_CORE_DATABASE_URL: ${STELLAR_DB_URL}
      STELLAR_CORE_URL: ${STELLAR_URL}
      LOG_LEVEL: "warn"
      INGEST: "true"
      PER_HOUR_RATE_LIMIT: "0"
      HISTORY_RETENTION_COUNT: "90000"
      NETWORK_PASSPHRASE: "Kin Mainnet ; December 2018"
      FRIENDBOT_URL: ''
      CURSOR_NAME: "HORIZON10"

    restart: always
    logging:
      driver: json-file
      options:
        max-size: 1000m
        max-file: "5"
  horizon-db:
    image: postgres:10-alpine
    command: postgres -c 'config_file=/etc/postgresql/postgresql.conf'
    restart: always
    container_name: horizon-db
    environment:
      POSTGRES_USER: stellar
      POSTGRES_PASSWORD: "G17WAqXN7nH0xXWs"
      POSTGRES_DB: horizon
    ports:
      - 5432:5432
    volumes:
      - /data/postgresql/data:/var/lib/postgresql/data
      - /var/run/postgresql:/var/run/postgresql
      - ./volumes/horizon-db/etc/postgresql:/etc/postgresql
